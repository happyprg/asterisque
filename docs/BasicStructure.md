# Basic Structure

asterisque ではノードが通信を行う時に双方のノードでセッションが発生します。通信は双方のノードがセッション上でメッセージと呼ばれるデータ単位を交換することによって行われます。

## Message

**Message** は数バイト〜数十キロバイトのバイナリから成る asterisque の基本的なデータ単位です。このサイズは小規模なデバイスでも一度にメモリ上に乗せられるデータ量を想定し、また将来的に UDP などへの適用も意識しています。

メッセージには以下の 4 種類が存在します。

* Open - リモート処理を起動する。
* Close - リモート処理の結果を転送する。
* Block - ローカル/リモート処理間でのメッセージングや Blob 転送に使用する。
* Control - セッション開始時の状態同期やセッション終了などの制御。

単純な RPC を行うケースでは、リモート処理の起動、及び結果の取得は Open メッセージと Close メッセージの 1 往復で行われます (これは後述するパイプの生成と消滅と等価です)。往路の Open メッセージには実行するリモート処理のファンクション番号と実行パラメータ、優先度が付属します。また復路の Close メッセージは正常終了または異常終了の結果が付属します。これは一般的な RPC 実装での Request-Response 型メッセージングと同じモデルです。

Block メッセージは RPC 実行時の Open から Close までの間に呼び出し元と飛び出し先の処理でメッセージ交換を行うために使用されます。この Block メッセージを使用してローカル/リモート処理の間で非同期メッセージング、ストリーミングまたは BLOB 転送を行う事が出来ます。ローカル/リモート処理は 1 度の呼び出し中に任意個数の Block メッセージを送受信することができます。

Control メッセージは接続時の状態の同期や接続終了などセッション制御に関するインタラクションを行うためのメッセージです。

## State Management

asterisque は **Node** と呼ばれる抽象化されたネットワーク上の通信端点を定義するところから始まります。

ノードがリモートと接続すると双方向に **Session** が発生します。Session にはリモート呼び出しが可能な **Function** のセット及びアプリケーション状態を持つ **Service** が関連付けられています。

リモートの Function を呼び出す時、双方の Session にその処理の開始から終了まで **Pipe** が発生します。Pipe は Block 及び Close メッセージの宛先を示し、またそのためのキューを持ちます。単純な RPC 呼び出しのケースでは Pipe も短命で消滅するが、1 度の呼び出し内で継続的にメッセージパッシングなどを行うケースでは長い寿命を持つでしょう。

asterisque でのリモート処理は双方のセッションで Pipe を Open し、Pipe を通じて Block を交換し、Pipe を Close するというモデルです。

## Communication Implementation

